# 功能更新說明

## 版本 2.0 - 智能預測增強版

### 🆕 新增功能

#### 1. Google Sheets 優先資料來源
- **優先使用 Google Sheets 資料**：系統現在會優先從 Google Sheets 讀取歷史資料進行預測
- **自動資料補充**：當 Google Sheets 中沒有資料時，自動爬取並儲存到 Sheets
- **資料一致性**：確保預測使用的是最完整和最新的資料

#### 2. 預測信心度閾值控制
- **可調整信心度**：使用者可設定最低信心度要求（50%-95%）
- **智能過濾**：只顯示達到信心度要求的預測結果
- **預設值**：系統預設最低信心度為 70%
- **友善提示**：當預測信心度不足時，提供改善建議

#### 3. 多種預測演算法選擇
- **頻率分析**：基於號碼出現頻率的統計分析
- **模式識別**：識別號碼間的關聯模式和趨勢
- **混合演算法**：結合多種方法的綜合預測（推薦使用）
- **機器學習**：使用先進的機器學習模型進行預測

#### 4. 增強的使用者介面
- **信心度滑桿**：直觀的滑桿控制信心度設定
- **預測方法選擇器**：下拉選單選擇預測演算法
- **詳細預測資訊**：顯示預測方法、參考資料數量、實際信心度等
- **即時回饋**：信心度滑桿即時顯示百分比

### 🔧 技術改進

#### 1. Google Sheets 管理器
- **新增 GoogleSheetsManager 類別**：統一管理所有 Google Sheets 操作
- **自動認證**：簡化 Google Sheets API 認證流程
- **錯誤處理**：完善的錯誤處理和重試機制
- **資料驗證**：確保儲存和讀取的資料格式正確

#### 2. 預測演算法優化
- **信心度計算**：為每種預測方法實作信心度計算
- **資料品質評估**：根據歷史資料品質調整預測信心度
- **演算法選擇**：支援動態選擇不同的預測演算法

#### 3. API 增強
- **新增參數**：預測 API 支援 `min_confidence` 和 `method` 參數
- **詳細回應**：API 回應包含更多預測相關資訊
- **錯誤訊息改善**：提供更友善和具體的錯誤訊息

### 📊 使用方式

#### 1. 設定信心度
```javascript
// 在網頁介面中調整信心度滑桿
// 範圍：50% - 95%
// 預設：70%
```

#### 2. 選擇預測方法
```javascript
// 可選擇的預測方法：
// - frequency: 頻率分析
// - pattern: 模式識別  
// - hybrid: 混合演算法（推薦）
// - ml: 機器學習
```

#### 3. API 呼叫範例
```json
{
  "periods": 20,
  "sheet_name": "大樂透資料",
  "min_confidence": 0.75,
  "method": "hybrid"
}
```

### 🎯 預測結果範例

```json
{
  "message": "預測完成",
  "prediction": {
    "predicted_numbers": [8, 16, 26, 34, 38, 41],
    "predicted_special": 48,
    "confidence": 0.773,
    "prediction_date": "2025-07-30 05:41:13"
  },
  "historical_data_count": 20,
  "method_used": "hybrid",
  "min_confidence_required": 0.75,
  "actual_confidence": 0.773
}
```

### 🚀 部署注意事項

1. **環境變數**：確保設定 `GOOGLE_SERVICE_ACCOUNT_KEY` 環境變數
2. **Google Sheets 權限**：服務帳戶需要對目標試算表有編輯權限
3. **依賴套件**：新增了 `google-auth` 和相關套件
4. **資料庫**：移除了 SQLite 依賴，完全使用 Google Sheets

### 📈 效能提升

- **資料讀取速度**：優化 Google Sheets 資料讀取效率
- **預測速度**：改善預測演算法執行效率
- **記憶體使用**：減少不必要的資料快取
- **錯誤恢復**：增強系統穩定性和錯誤恢復能力

### 🔄 向後相容性

- **API 相容**：舊版 API 呼叫仍然支援（使用預設參數）
- **資料格式**：Google Sheets 資料格式保持一致
- **部署流程**：部署步驟基本不變，僅需更新環境變數

---

**更新日期**：2025-07-31  
**版本**：2.0  
**開發者**：Manus AI Assistant

